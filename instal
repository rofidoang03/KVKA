#!/bin/bash

# Fungsi untuk memeriksa hak akses root
cek_root() {
    if [ "$EUID" -ne 0 ]; then
        echo "[x] Jalankan sebagai root."
        exit 1
    fi
}

# Fungsi untuk memperbaharui repositori
memperbaharui_repositori() {
    echo -e "[*] Memperbaharui repositori."
    apt-get update -y || {
        echo "[x] Gagal memperbaharui repositori."
        exit 1
    }
    echo "[+] Repositori berhasil diperbaharui."
}

# Fungsi untuk menginstal dependensi
instal_dependensi() {
    echo "[*] Menginstal FFmpeg."
    apt-get install ffmpeg -y || {
        echo "[x] Gagal menginstal FFmpeg."
        exit 1
    }
    echo "[+] FFmpeg berhasil diinstal."

    echo "[*] Menginstal pv."
    apt-get install pv -y || {
        echo "[x] Gagal menginstal pv."
        exit 1
    }
    echo "[+] pv berhasil diinstal."
}

# Fungsi untuk memindahkan program ke /usr/bin/
pindahkan_peogram() {
    program="src/kvka"
    mkdir -p "/root/kvka/hasil_konversi"
    chmod a+rwx "${program}"
    mv "${program}" /usr/bin/ || {
        # echo "[x] Gagal memindahkan program ke /usr/bin/."
        exit 1
    }
    # echo "[+] Program berhasil dipindahkan."
}

# Skrip utama
check_root

echo -n "Selamat datang di menu instalasi kvka." | pv -qL 10
echo -e "\n"
read -p "Apakah Anda ingin menginstal kvka [Y/n] : " n

if [ "$n" == "Y" ] || [ "$n" == "y" ]; then
    echo -e "\n[*] Mengecek koneksi internet."
    sleep 3
    ping -c 1 google.com >> /dev/null 2>&1

    if [ $? -eq 0 ]; then
        read -p "[+] Anda memiliki koneksi internet, tekan Enter untuk melanjutkan proses instalasi... " d
        echo -e "\n[*] Memulai proses instalasi."

        update_repositories
        instal_dependensi
        pindahkan_program

        echo -e "\n[+] Instalasi selesai."
        sleep 1
        echo "[+] Untuk menjalankan kvka ketikkan perintah 'kvka'."
        exit 0
    else
        echo "[x] Anda tidak memiliki koneksi internet. Pastikan Anda terhubung ke internet untuk menginstal kvka."
        exit 1
    fi

elif [ "$n" == "N" ] || [ "$n" == "n" ]; then
    exit 0

else
    echo "[x] Masukan tidak valid."
    exit 1
fi
