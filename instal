#!/bin/bash

# Variabel warna
b="\e[1;34m"
m="\e[1;31m"
h="\e[1;32m"
r="\e[0m"

# Membersihkan layar terminal
clear

# Fungsi untuk memeriksa hak akses root
cek_root() {
    if [ "$EUID" -ne 0 ]; then
        echo -e "${m}[x] ${r}Jalankan sebagai root."
        exit 1
    fi
}

# Fungsi untuk memperbaharui repositori
memperbaharui_repositori() {
    echo -e "${b}[*] ${r}Memperbaharui repositori."
    apt-get update -y || {
        echo -e "${m}[x] ${r}Gagal memperbaharui repositori."
        exit 1
    }
    echo -e "${h}[+] ${r}Repositori berhasil diperbaharui."
}

# Fungsi untuk menginstal dependensi
instal_dependensi() {
    echo -e "${b}[*] ${r}Menginstal FFmpeg."
    apt-get install ffmpeg -y || {
        echo -e "${m}[x] ${r}Gagal menginstal FFmpeg."
        exit 1
    }
    echo -e "${h}[+] ${r}FFmpeg berhasil diinstal."

    echo -e "${b}[*] ${r}Menginstal pv."
    apt-get install pv -y || {
        echo -e "${m}[x] ${r}Gagal menginstal pv."
        exit 1
    }
    echo -e "${h}[+] ${r}pv berhasil diinstal."
}

# Fungsi untuk memindahkan program ke /usr/bin/
pindahkan_program() {
    program="src/kvka"
    mkdir -p "/root/kvka/hasil_konversi"
    chmod a+rwx "${program}"
    mv "${program}" /usr/bin/ || {
        # echo "[x] Gagal memindahkan program ke /usr/bin/."
        exit 1
    }
    # echo "[+] Program berhasil dipindahkan."
}

# Skrip utama
cek_root

echo -n "Selamat datang di menu instalasi kvka." | pv -qL 10
echo -e "\n"
read -p "Apakah Anda ingin menginstal kvka [Y/n] : " n

if [ "$n" == "Y" ] || [ "$n" == "y" ]; then
    echo -e "\n${b}[*] ${r}Mengecek koneksi internet."
    sleep 3
    ping -c 1 google.com >> /dev/null 2>&1

    if [ $? -eq 0 ]; then
        read -p $'\e[1;32m[+] \e[0mAnda memiliki koneksi internet, tekan Enter untuk melanjutkan proses instalasi... ' d
        echo -e "\n${b}[*] ${r}Memulai proses instalasi."

        memperbaharui_repositori
        instal_dependensi
        pindahkan_program

        echo -e "\n${h}[+] ${r}Instalasi selesai."
        sleep 1
        echo -e "${h}[+] ${r}Untuk menjalankan kvka ketikkan perintah '${h}kvka${r}'."
        exit 0
    else
        echo -e "${m}[x] ${r}Anda tidak memiliki koneksi internet. Pastikan Anda terhubung ke internet untuk menginstal kvka."
        exit 1
    fi

elif [ "$n" == "N" ] || [ "$n" == "n" ]; then
    exit 0

else
    echo -e "${m}[x] ${r}Masukan tidak valid."
    exit 1
fi
